services:
  manager:
    build:
      context: .
      dockerfile: Manager/Dockerfile
    image: feature-switcher-manager:latest
    environment:
      ASPNETCORE_ENVIRONMENT: "Production"
    ports:
      - "8080:5033"
    volumes:
      - type: volume
        source: fs_manager_data
        target: /data
    depends_on:
      - node
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost:5033/health || exit 1"]
      interval: 10s
      timeout: 3s
      retries: 5

  node:
    build:
      context: .
      dockerfile: Node/Dockerfile
    image: feature-switcher-node:latest
    environment:
      ASPNETCORE_ENVIRONMENT: "Production"
      NodeConfiguration__Environment: "docker"
      ManagerSettings__Url: "http://manager:5033"
    ports:
      - "8081:5216"
    volumes:
      - type: volume
        source: fs_node_data
        target: /data
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost:5216/health || exit 1"]
      interval: 10s
      timeout: 3s
      retries: 5

volumes:
  fs_manager_data:
    name: fs_manager_data
  fs_node_data:
    name: fs_node_data